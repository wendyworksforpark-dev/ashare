#!/usr/bin/env python3
"""æ·»åŠ é‡‘å±èµ›é“è‚¡ç¥¨åˆ°è‡ªé€‰åˆ—è¡¨"""

import sys
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, str(Path(__file__).parent.parent))

from scripts.batch_add_to_watchlist import add_stocks_to_watchlist, print_results
from scripts.update_watchlist_category import update_category


# é‡‘å±æ¦‚å¿µè‚¡åˆ—è¡¨ï¼ˆä»æˆªå›¾æ•´ç†ï¼‰
METAL_STOCKS = [
    ("000426", "å…´ä¸šé“¶é”¡", "é“¶é”¡"),
    ("600259", "ä¸­ç¨€æœ‰è‰²", "ç¨€åœŸ"),
    ("001280", "ä¸­å›½è½´ä¸š", "è½´æ‰¿"),
    ("000657", "ä¸­é’¨é«˜æ–°", "é’¨"),
    ("002842", "ç¿”é¹­é’¨ä¸š", "é’¨"),
    ("000960", "é”¡ä¸šè‚¡ä»½", "é”¡"),
    ("600301", "åé”¡æœ‰è‰²", "é”¡"),
    ("002378", "ç« æºé’¨ä¸š", "é’¨"),
    ("600549", "å¦é—¨é’¨ä¸š", "é’¨"),
    ("600459", "è´µç ”é“‚ä¸š", "è´µé‡‘å±"),
    ("301026", "æµ©é€šç§‘æŠ€", "é“œ"),
    ("000962", "ä¸œæ–¹é’½ä¸š", "é’½"),
    ("000831", "ä¸­å›½ç¨€åœŸ", "ç¨€åœŸ"),
    ("002428", "äº‘å—é”—ä¸š", "é”—"),
    ("600392", "ç››å’Œèµ„æº", "ç¨€åœŸ"),
    ("002978", "å®‰å®è‚¡ä»½", "é’›"),
    ("920068", "å¤©å·¥è‚¡ä»½", "ç‰¹é’¢"),
    ("002167", "ä¸œæ–¹é”†ä¸š", "é”†"),
    ("601958", "é‡‘é’¼è‚¡ä»½", "é’¼"),
    ("688750", "é‡‘å¤©é’›ä¸š", "é’›"),
    ("002738", "ä¸­çŸ¿èµ„æº", "é”‚"),
    ("600111", "åŒ—æ–¹ç¨€åœŸ", "ç¨€åœŸ"),
    ("600281", "åé˜³æ–°æ", "æ–°ææ–™"),
    ("600456", "å®é’›è‚¡ä»½", "é’›"),
    ("002182", "å®æ­¦é•ä¸š", "é•"),
    ("300328", "å®œå®‰ç§‘æŠ€", "é•åˆé‡‘"),
    ("002149", "è¥¿éƒ¨ææ–™", "æ–°ææ–™"),
]


def main():
    """ä¸»å‡½æ•°ï¼šæ£€æŸ¥å¹¶æ·»åŠ é‡‘å±æ¦‚å¿µè‚¡"""
    print("\n" + "=" * 60)
    print("é‡‘å±èµ›é“è‚¡ç¥¨ç®¡ç†")
    print("=" * 60)

    # æ­¥éª¤1: æ·»åŠ è‚¡ç¥¨åˆ°è‡ªé€‰ï¼ˆè·³è¿‡å·²å­˜åœ¨çš„ï¼‰
    print("\nğŸ“ æ­¥éª¤ 1: æ·»åŠ è‚¡ç¥¨åˆ°è‡ªé€‰åˆ—è¡¨...")
    added, skipped, failed = add_stocks_to_watchlist(
        METAL_STOCKS,
        simulate_purchase=True,  # æ¨¡æ‹Ÿä¹°å…¥ï¼ˆè®°å½•ä»·æ ¼ï¼‰
        category="é‡‘å±"
    )

    # æ­¥éª¤2: æ›´æ–°å·²å­˜åœ¨ä½†åˆ†ç±»ä¸æ˜¯"é‡‘å±"çš„è‚¡ç¥¨
    print("\nğŸ“ æ­¥éª¤ 2: æ›´æ–°åˆ†ç±»ä¸º'é‡‘å±'...")
    all_tickers = [ticker for ticker, _, _ in METAL_STOCKS]
    updated, not_found = update_category(all_tickers, "é‡‘å±")

    # æ‰“å°ç»“æœ
    print_results("æ·»åŠ é‡‘å±æ¦‚å¿µè‚¡ - ç»“æœ", added, skipped, failed)

    if updated:
        print(f"\nâœ… æ›´æ–°åˆ†ç±» {len(updated)} åªè‚¡ç¥¨ â†’ é‡‘å±")
        for ticker in updated[:5]:  # åªæ˜¾ç¤ºå‰5ä¸ª
            print(f"   {ticker}")
        if len(updated) > 5:
            print(f"   ... è¿˜æœ‰ {len(updated) - 5} åª")

    print("\n" + "=" * 60)
    print(f"ğŸ“Š æœ€ç»ˆç»Ÿè®¡:")
    print(f"   æ–°æ·»åŠ : {len(added)}")
    print(f"   å·²å­˜åœ¨ï¼ˆè·³è¿‡ï¼‰: {len(skipped)}")
    print(f"   æ›´æ–°åˆ†ç±»: {len(updated)}")
    print(f"   å¤±è´¥: {len(failed)}")
    print("=" * 60 + "\n")


if __name__ == "__main__":
    main()
